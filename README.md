# Cinema Backend API
Этот проект представляет собой бэкенд API для системы управления 
кинотеатром, написанный на Python с использованием FastAPI. Он предоставляет RESTful интерфейс для взаимодействия с различными сущностями кинотеатра, такими как сеансы, фильмы, залы и билеты.

## Установка
- Склонируйте репозиторий:
```
git clone git@github.com:OrKelly/cinema-backend.git
cd cinema_backend
```
- Активируйте виртуальное окружение:
```
poetry shell
```
- Установите переменные окружения. Скопируйте их из .env.example в .env и подставьте свои значения
- Установите зависимости:
```
poetry install
```
## Запуск сервера:

### Локальный запуск:

- Для локального запуска сервера вне docker контейнера, запустить Minio и выполните команду:
```
python main.py
```
### Запуск через Docker

В проекте инициализировать Makefile для более удобной работы с проектом через Docker контейнеры

#### Команды:

* **`make storages-up`**: Запускает сервисы хранения.
* **`make storages-down`**: Останавливает сервисы хранения
* **`make postgres-psql`**: Запускает `psql`  для интерактивной работы с базой данных.
* **`make app-up`**: Запускает приложение (без других сервисов).
* **`make app-down`**: Останавливает приложение.
* **`make project-up`**: Запускает все сервисы (приложение, БД и S3 хранилище).
* **`make project-down`**: Останавливает все сервисы.
* **`make migrate`**: Выполняет миграции.
* **`make makemigration`**: Создает новую версию миграции.
* **`make tests`**: Запускает тесты приложения.
* **`make lint`**: Прогнать линтер.
* **`make format`**: Поправить ошибки, найденные линтером.

## Структура проекта
Проект организован в соответствии с принципами слоистой архитектуры. Архитектура проекта:

```
cinema-backend/
├── api/               # API endpoints
│   └── v1/            
│       ├── ...        
│       └── users/   
│           ├── handlers.py
│           ├── filters.py
│           └── schemas.py
├── core/              # Core logic (Конфиги, базовые классы и т.д.)
│   └── ...            
│── apps/              # Apps (Приложения, вся логика и инфра приложения)
│   └── users/         # Приложение пользователя 
│       ├── models     # Модели приложения
│       ├── repositories # Репозитории для получения данных из хранилищ
│       ├── services   # Сервисы -  взаимодействуют с репозиториями и выполняют операции над данными
│       └── use_cases  Юзкейсы (Use Cases) - бизнес-логика на уровне сценариев использования.
├── main.py            # Точка входа в приложение
├── tests/             # Тесты
└── pyproject.toml      # Конфигурация Poetry
```
## Документация
Документация API доступна по адресу: http://127.0.0.1:8000/docs (или другой адрес, если вы изменили порт) и http://127.0.0.1:8000/redoc.

## Тестирование
Для запуска тестов используйте Poetry:
```
poetry run pytest
```
